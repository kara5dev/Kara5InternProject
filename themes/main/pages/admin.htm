url = "/admin-user"
layout = "default"
title = "admin-user"

[session]
security = "user"
redirect = "home"
checkToken = 0
==
<?php
use Illuminate\Support\Facades\Storage;

function onStart()
{
    $files = collect(Storage::disk('media')->files('templates'))
        ->map(function ($file) {
            return [
                'name' => basename($file),
                'path' => Storage::disk('media')->url($file),
                'extension' => pathinfo($file, PATHINFO_EXTENSION),
                'raw_path' => $file,
            ];
        });

    $this['files'] = $files;
}
function onDownload(){
    $file = post("file");
    return Storage::disk("media")->download($file);
}
function onUpload(){
    $file = Input::file('image');
    if(!$file){
        throw new ApplicationException('No file uploaded');
    }
    $allowedMime = ['image/jpeg', 'image/png', 'image/webp'];

    if (!in_array($file->getMimeType(), $allowedMime)) {
        throw new ApplicationException('Invalid image type.');
    }

    $path = Storage::disk("media")->putFileAs('templates', $file, $file->getClientOriginalName());
     $files = collect(Storage::disk('media')->files('templates'))
        ->map(function ($file) {
            return [
                'name' => basename($file),
                'path' => Storage::disk('media')->url($file),
                'extension' => strtolower(pathinfo($file, PATHINFO_EXTENSION)),
                'raw_path' => $file,
            ];
        });
    $this["files"] = $files;

     Flash::success('File uploaded successfully!');
}
?>
==
<div class="admin-section section-padding--y">
    <div class="container">
        <div class="section-heading-blog section-padding--b-2">
                <div class="hero-subtitle">
                    <div class="hero-subtitle-icon">
                        {% partial 'icons/earth' %}
                    </div>
                    <div class="hero-subtitle-text">IMAGES</div>
                </div>
                <div class="brand-title">
                    <h2>Our nice designs</h2>
                </div>
              
                    <form data-request="onUpload"  enctype="multipart/form-data" data-request-files="true" data-request-update="'site/media-list': '#media-list'">
                    <input type="file" accept="image/*,video/*" required class="file-input" name="image">
                <div class="white-button">
                    <button type="submit" class="nav-link contact-link">
                        Upload Image
                        <span class="arrow-wrapper">
                            <span class="arrow arrow-1">{% partial 'icons/arrow-right'%}</span>
                            <span class="arrow arrow-2">{% partial 'icons/arrow-right'%}</span>
                        </span>
                    </button>
                    </form>
                </div> 
        </div>
        <div class="content-section">
            <div class="blog-content" id="media-list">
              {% partial 'site/media-list' %}
            </div>
        </div>
    </div>
</div>